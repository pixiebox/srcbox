;(function(m,a){"function"===typeof define&&define.amd?define(a):"object"===typeof exports?module.exports=a:m.srcBox=a(m)})(this,function(m){Object.size=function(b){var d=0,a;for(a in b)b.hasOwnProperty(a)&&d++;return d};var a={breakpoint:0,breakpointVal:0,currentBreakpoint:0,lazyElems:[],mergedElements:[],selector:{},viewPortWidth:0,addEvent:function(b,d,a){d.addEventListener?d.addEventListener(b,a,!1):d.attachEvent?d.attachEvent("on"+b,a):d[b]=a},debounce:function(b,d,a){var e;return function(){var f=
this,g=arguments,k=a&&!e;clearTimeout(e);e=setTimeout(function(){e=null;a||b.apply(f,g)},d);k&&b.apply(f,g)}},devicePixelRatio:function(){return"devicePixelRatio"in window?window.devicePixelRatio:1},extend:function(b,d){var c={};a.forEach(b,function(a,d){c[d]=b[d]});a.forEach(d,function(b,a){c[a]=d[a]});return c},forEach:function(b,a,c){if("[object Object]"===Object.prototype.toString.call(b))for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&a.call(c,b[e],e,b);else{e=0;for(var f=b.length;e<
f;e++)a.call(c,b[e],e,b)}},getBreakpoint:function(b,d){for(var c=d,e=0,f={},g,k,h,l,n;g=b[e];){l=g.minWidth;k=g.maxWidth;h="minDevicePixelRatio"in g?g.minDevicePixelRatio:0;n="hide"in g;if(0<d){if(l&&k&&d>=l&&d<=k||l&&!k&&d>=l||k&&!l&&d<=k)if(!h||h&&a.devicePixelRatio()>=h)f=g,k&&n&&(f.folder="hide")}else if(0>=c||l<c||k<c)c=l||k||c,f=g;e++}return f},getViewportWidthInCssPixels:function(){for(var b=Math,a=[window.innerWidth,window.document.documentElement.clientWidth,window.document.documentElement.offsetWidth,
window.document.body.clientWidth],c=0,e,f=window.screen.width;c<a.length;c++)isNaN(a[c])&&(a.splice(c,1),c--);a.length&&(e=b.max.apply(b,a),isNaN(f)||(e=b.min(f,e)));return e||f||0},inviewport:function(b){b=b.getBoundingClientRect();var a=document.documentElement;return 0<=b.top&&0<=b.left&&b.bottom<=(window.innerHeight||a.clientHeight)&&b.right<=(window.innerWidth||a.clientWidth)},isEmpty:function(b){for(var a in b)if(b.hasOwnProperty(a))return!1;return!0},orientationEvent:function(){return a.supportsOrientationChange()?
"orientationchange":"resize"},removeClass:function(b,a){var c="",e,f=b.className.split(" ");for(e=0;e<f.length;e++)f[e]!==a&&(c+=f[e]+" ");b.className=c},removeEvent:function(b,a,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a.splice(b,1)},setBreakpoint:function(b,d){if("hide"==d)b.className+=" srcbox-hidden","img"!=b.nodeName.toLowerCase()&&(b.style.backgroundImage="",b.style.backgroundRepeat="");else{0<=b.className.indexOf("srcbox-hidden")&&(b.className=
b.className.replace(/(?:^|\s)srcbox-hidden(?!\S)/g,""));var c=b.getAttribute("data-breakpoint"),e=b.getAttribute("data-img");if(!c||!e)throw Error('srcBox.js [function setBreakpoint]: The provided elements are missing a data-breakpoint or data-img attribute: <img data-breakpoint="/path/to/folder/{breakpoint}" data-img="some-img.jpg" />');c=(c+e).replace("{folder}",d);a.setSrc(b,c)}},setImage:function(b,d){var c=b.getAttribute("data-breakpointwidth"),c=null!==c?c:d.parentOffset?b.parentNode.offsetWidth:
a.getViewportWidthInCssPixels(),c=a.getBreakpoint(d.breakpoints,c),e;e=a.isEmpty(c)?e=d.defaultBreakpoint.folder:c.folder;a.setBreakpoint(b,e)},setImages:function(b,d){viewPortWidth=a.getViewportWidthInCssPixels();breakpoint=a.getBreakpoint(h.settings[d].breakpoints,viewPortWidth);breakpointVal=a.isEmpty(breakpoint)?h.settings[d].defaultBreakpoint.folder:breakpoint.maxWidth||breakpoint.minWidth;a.currentBreakpoint!=breakpointVal&&(d==a.selector[Object.size(a.selector)-1]&&(a.currentBreakpoint=breakpointVal),
a.forEach(b,function(c,e){a.setImage(b[e],h.settings[d])}),a.addEvent("scroll",window,a.setLazySrc))},setLazySrc:function(){for(var b=a.lazyElems.length;b--;)a.inviewport(a.lazyElems[b])&&(a.lazyElems[b].src=a.lazyElems[b].getAttribute("data-lag-src"),a.lazyElems[b].removeAttribute("height"),a.lazyElems.splice(b,1));a.lazyElems.length||a.removeEvent("scroll",window,a.setLazySrc)},setSrc:function(b,d){/(^|\s)lag(\s|$)/.test(b.className)?(b.setAttribute("data-lag-src",d),a.lazyElems.push(b)):"img"===
b.nodeName.toLowerCase()?(b.src=d,b.removeAttribute("height")):(b.style.backgroundImage="url("+d+")",b.style.backgroundRepeat="no-repeat")},supportsOrientationChange:function(){return"ontouchstart"in window}},h={settings:[],init:function(b,d,c){a.currentBreakpoint=0;if(document.all&&!document.addEventListener){var e=Array.prototype.slice;Array.prototype.slice=function(){if(this instanceof Array)return e.apply(this,arguments);for(var a=[],b=2<=arguments.length?arguments[1]:this.length,d=1<=arguments.length?
arguments[0]:0;d<b;d++)a.push(this[d]);return a}}c=c||document;var f=Array.prototype.slice.call(c.querySelectorAll(b));c={breakpoints:[{folder:"480",maxWidth:480},{folder:"640",minWidth:481,maxWidth:767},{folder:"900",minWidth:768,maxWidth:900},{folder:"1170",minWidth:992},{folder:"900",minWidth:748,maxWidth:1024},{folder:"640",maxWidth:320,minDevicePixelRatio:2},{folder:"900",minWidth:320,maxWidth:667,minDevicePixelRatio:2},{folder:"2048",minWidth:414,maxWidth:736,minDevicePixelRatio:3},{folder:"2048",
minWidth:748,maxWidth:1024,minDevicePixelRatio:2}],parentOffset:!0};c="object"===typeof d&&"breakpoints"in d?"extend"in d&&!0===d.extend?a.extend(c,d):d:a.extend(c,d);var g,k=function(){g--;if(!g)h.settings[b].onComplete()};c.defaultBreakpoint="defaultBreakpoint"in d?d.defaultBreakpoint:{folder:"1170"};h.settings[b]=c;a.selector[Object.size(a.selector)]=b;a.mergedElements[b]=f;a.setImages(f,b);a.setLazySrc();a.addEvent("scroll",window,a.setLazySrc);a.addEvent(a.orientationEvent(),window,a.debounce(function(){a.forEach(a.selector,
function(b,d){a.setImages(a.mergedElements[a.selector[d]],a.selector[d])})},250));"onComplete"in h.settings[b]&&(g=f.length)&&a.forEach(f,function(d,c){if(/[ws]*(lag)+[ws]*/.test(f[c].className)){if(g--,!g)h.settings[b].onComplete()}else if(f[c].onload=k,"complete"==f[c].readyState)f[c].onload();else if(f[c].readyState)f[c].src=f[c].src;else if(f[c].complete)f[c].onload();else if(void 0===f[c].complete){var e=f[c].src;f[c].src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
f[c].src=e}a.setImage(f[c],h.settings[b])})},reset:function(b){a.currentBreakpoint=0;var d=a.mergedElements[b];a.forEach(a.mergedElements[b],function(c,d){a.removeClass(a.mergedElements[b][d],b.substring(1))});h.init(b,h.settings[b]);a.forEach(d,function(a,e){d[e].className+=b.substring(1)})}};return h});