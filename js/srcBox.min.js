;(function(m,b){"function"===typeof define&&define.amd?define(b):"object"===typeof exports?module.exports=b:m.srcBox=b(m)})(this,function(m){Object.size=function(a){var c=0,b;for(b in a)a.hasOwnProperty(b)&&c++;return c};var b={breakpoint:0,breakpointVal:0,currentBreakpoint:0,lazyElems:[],mergedElements:[],selector:{},viewPortWidth:0,addEvent:function(a,c,b){c.addEventListener?c.addEventListener(a,b,!1):c.attachEvent?c.attachEvent("on"+a,b):c[a]=b},debounce:function(a,c,b){var e;return function(){var f=
this,g=arguments,k=b&&!e;clearTimeout(e);e=setTimeout(function(){e=null;b||a.apply(f,g)},c);k&&a.apply(f,g)}},devicePixelRatio:function(){return"devicePixelRatio"in window?window.devicePixelRatio:1},extend:function(a,c){var d={};b.forEach(a,function(b,c){d[c]=a[c]});b.forEach(c,function(a,b){d[b]=c[b]});return d},forEach:function(a,b,d){if("[object Object]"===Object.prototype.toString.call(a))for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&b.call(d,a[e],e,a);else{e=0;for(var f=a.length;e<
f;e++)b.call(d,a[e],e,a)}},getBreakpoint:function(a,c){for(var d=c,e=0,f={},g,k,h,l,n;g=a[e];){l=g.minWidth;k=g.maxWidth;h="minDevicePixelRatio"in g?g.minDevicePixelRatio:0;n="hide"in g;if(0<c){if(l&&k&&c>=l&&c<=k||l&&!k&&c>=l||k&&!l&&c<=k)if(!h||h&&b.devicePixelRatio()>=h)f=g,k&&n&&(f.folder="hide")}else if(0>=d||l<d||k<d)d=l||k||d,f=g;e++}return f},getViewport:function(){var a=window,b="inner";"innerWidth"in window||(b="client",a=document.documentElement||document.body);return{width:a[b+"Width"],
height:a[b+"Height"]}},inviewport:function(a){a=a.getBoundingClientRect();var b=document.documentElement;return 0<=a.top&&0<=a.left&&a.bottom<=(window.innerHeight||b.clientHeight)&&a.right<=(window.innerWidth||b.clientWidth)},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},orientationEvent:function(){return b.supportsOrientationChange()?"orientationchange":"resize"},removeClass:function(a,b){var d="",e,f=a.className.split(" ");for(e=0;e<f.length;e++)f[e]!==b&&(d+=f[e]+
" ");a.className=d},removeEvent:function(a,b,d){b.removeEventListener?b.removeEventListener(a,d,!1):b.detachEvent?b.detachEvent("on"+a,d):b.splice(a,1)},setBreakpoint:function(a,c){if("hide"==c)a.className+=" srcbox-hidden","img"!=a.nodeName.toLowerCase()&&(a.style.backgroundImage="",a.style.backgroundRepeat="");else{0<=a.className.indexOf("srcbox-hidden")&&(a.className=a.className.replace(/(?:^|\s)srcbox-hidden(?!\S)/g,""));var d=a.getAttribute("data-breakpoint"),e=a.getAttribute("data-img");if(!d||
!e)throw Error('srcBox.js [function setBreakpoint]: The provided elements are missing a data-breakpoint or data-img attribute: <img data-breakpoint="/path/to/folder/{breakpoint}" data-img="some-img.jpg" />');d=(d+e).replace("{folder}",c);b.setSrc(a,d)}},setImage:function(a,c){var d=a.getAttribute("data-breakpointwidth"),d=null!==d?d:c.parentOffset?a.parentNode.offsetWidth:b.getViewport().width,d=b.getBreakpoint(c.breakpoints,d),e;e=b.isEmpty(d)?e=c.defaultBreakpoint.folder:d.folder;b.setBreakpoint(a,
e)},setImages:function(a,c){viewPortWidth=b.getViewport().width;breakpoint=b.getBreakpoint(h.settings[c].breakpoints,viewPortWidth);breakpointVal=b.isEmpty(breakpoint)?h.settings[c].defaultBreakpoint.folder:breakpoint.maxWidth||breakpoint.minWidth;b.currentBreakpoint!=breakpointVal&&(c==b.selector[Object.size(b.selector)-1]&&(b.currentBreakpoint=breakpointVal),b.forEach(a,function(d,e){b.setImage(a[e],h.settings[c])}),b.addEvent("scroll",window,b.setLazySrc))},setLazySrc:function(){for(var a=b.lazyElems.length;a--;)b.inviewport(b.lazyElems[a])&&
(b.lazyElems[a].src=b.lazyElems[a].getAttribute("data-lag-src"),b.lazyElems[a].removeAttribute("height"),b.lazyElems.splice(a,1))},setSrc:function(a,c){/(^|\s)lag(\s|$)/.test(a.className)?(a.setAttribute("data-lag-src",c),b.lazyElems.push(a)):"img"===a.nodeName.toLowerCase()?(a.src=c,a.removeAttribute("height")):(a.style.backgroundImage="url("+c+")",a.style.backgroundRepeat="no-repeat")},supportsOrientationChange:function(){return"ontouchstart"in window}},h={settings:[],init:function(a,c,d){b.currentBreakpoint=
0;if(document.all&&!document.addEventListener){var e=Array.prototype.slice;Array.prototype.slice=function(){if(this instanceof Array)return e.apply(this,arguments);for(var a=[],b=2<=arguments.length?arguments[1]:this.length,c=1<=arguments.length?arguments[0]:0;c<b;c++)a.push(this[c]);return a}}d=d||document;var f=Array.prototype.slice.call(d.querySelectorAll(a));d={breakpoints:[{folder:"480",maxWidth:480},{folder:"640",minWidth:481,maxWidth:767},{folder:"900",minWidth:768,maxWidth:900},{folder:"1170",
minWidth:992},{folder:"900",minWidth:748,maxWidth:1024},{folder:"640",maxWidth:320,minDevicePixelRatio:2},{folder:"900",minWidth:320,maxWidth:667,minDevicePixelRatio:2},{folder:"2048",minWidth:414,maxWidth:736,minDevicePixelRatio:3},{folder:"2048",minWidth:748,maxWidth:1024,minDevicePixelRatio:2}],debug:!1,parentOffset:!0};d="object"===typeof c&&"breakpoints"in c?"extend"in c&&!0===c.extend?b.extend(d,c):c:b.extend(d,c);var g,k=function(){g--;if(!g)h.settings[a].onComplete()};d.defaultBreakpoint=
"defaultBreakpoint"in c?c.defaultBreakpoint:{folder:"1170"};h.settings[a]=d;b.selector[Object.size(b.selector)]=a;b.mergedElements[a]=f;b.setImages(f,a);b.setLazySrc();b.lazyElems.length&&b.addEvent("scroll",window,b.setLazySrc);h.settings[a].debug&&b.addEvent(b.orientationEvent(),window,b.debounce(function(){b.forEach(b.selector,function(a,c){b.setImages(b.mergedElements[b.selector[c]],b.selector[c])})},250));"onComplete"in h.settings[a]&&(g=f.length)&&b.forEach(f,function(c,d){if(/[ws]*(lag)+[ws]*/.test(f[d].className)){if(g--,
!g)h.settings[a].onComplete()}else if(f[d].onload=k,"complete"==f[d].readyState)f[d].onload();else if(f[d].readyState)f[d].src=f[d].src;else if(f[d].complete)f[d].onload();else if(void 0===f[d].complete){var e=f[d].src;f[d].src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";f[d].src=e}b.setImage(f[d],h.settings[a])})},reset:function(a){b.currentBreakpoint=0;var c=b.mergedElements[a];b.forEach(b.mergedElements[a],function(c,e){b.removeClass(b.mergedElements[a][e],a.substring(1))});
h.init(a,h.settings[a]);b.forEach(c,function(b,e){c[e].className+=a.substring(1)})}};return h});