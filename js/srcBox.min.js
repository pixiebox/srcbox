;(function(m,a){"function"===typeof define&&define.amd?define(a):"object"===typeof exports?module.exports=a:m.srcBox=a(m)})(this,function(m){Object.size=function(b){var e=0,a;for(a in b)b.hasOwnProperty(a)&&e++;return e};var a={breakpoint:0,breakpointVal:0,currentBreakpoint:0,lazyElems:[],mergedElements:[],selector:{},viewPortWidth:0,addEvent:function(b,e,a){e.addEventListener?e.addEventListener(b,a,!1):e.attachEvent?e.attachEvent("on"+b,a):e[b]=a},debounce:function(b,e,a){var c;return function(){var f=
this,g=arguments,k=a&&!c;clearTimeout(c);c=setTimeout(function(){c=null;a||b.apply(f,g)},e);k&&b.apply(f,g)}},devicePixelRatio:function(){return"devicePixelRatio"in window?window.devicePixelRatio:1},extend:function(b,e){var d={};a.forEach(b,function(a,e){d[e]=b[e]});a.forEach(e,function(b,a){d[a]=e[a]});return d},forEach:function(b,a,d){if("[object Object]"===Object.prototype.toString.call(b))for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.call(d,b[c],c,b);else{c=0;for(var f=b.length;c<
f;c++)a.call(d,b[c],c,b)}},getBreakpoint:function(b,e){for(var d=e,c=0,f={},g,k,h,l,n;g=b[c];){l=g.minWidth;k=g.maxWidth;h="minDevicePixelRatio"in g?g.minDevicePixelRatio:0;n="hide"in g;if(0<e){if(l&&k&&e>=l&&e<=k||l&&!k&&e>=l||k&&!l&&e<=k)if(!h||h&&a.devicePixelRatio()>=h)f=g,k&&n&&(f.folder="hide")}else if(0>=d||l<d||k<d)d=l||k||d,f=g;c++}return f},getViewportWidthInCssPixels:function(){for(var b=Math,a=[window.innerWidth,window.document.documentElement.clientWidth,window.document.documentElement.offsetWidth,
window.document.body.clientWidth],d=0,c,f=window.screen.width;d<a.length;d++)isNaN(a[d])&&(a.splice(d,1),d--);a.length&&(c=b.max.apply(b,a),isNaN(f)||(c=b.min(f,c)));return c||f||0},inviewport:function(b){b=b.getBoundingClientRect();var a=document.documentElement;return 0<=b.top&&0<=b.left&&b.bottom<=(window.innerHeight||a.clientHeight)&&b.right<=(window.innerWidth||a.clientWidth)},isEmpty:function(b){for(var a in b)if(b.hasOwnProperty(a))return!1;return!0},orientationEvent:function(){return a.supportsOrientationChange()?
"orientationchange":"resize"},removeClass:function(b,a){var d="",c,f=b.className.split(" ");for(c=0;c<f.length;c++)f[c]!==a&&(d+=f[c]+" ");b.className=d},removeEvent:function(b,a,d){a.removeEventListener?a.removeEventListener(b,d,!1):a.detachEvent?a.detachEvent("on"+b,d):a.splice(b,1)},setBreakpoint:function(b,e){if("hide"==e)b.className+=" srcbox-hidden","img"!=b.nodeName.toLowerCase()&&(b.style.backgroundImage="",b.style.backgroundRepeat="");else{0<=b.className.indexOf("srcbox-hidden")&&(b.className=
b.className.replace(/(?:^|\s)srcbox-hidden(?!\S)/g,""));var d=b.getAttribute("data-breakpoint"),c=b.getAttribute("data-img");if(!d||!c)throw Error('srcBox.js [function setBreakpoint]: The provided elements are missing a data-breakpoint or data-img attribute: <img data-breakpoint="/path/to/folder/{breakpoint}" data-img="some-img.jpg" />');d=(d+c).replace("{folder}",e);a.setSrc(b,d)}},setImage:function(b,e){var d=b.getAttribute("data-breakpointwidth"),d=null!==d?d:e.parentOffset?b.parentNode.offsetWidth:
a.getViewportWidthInCssPixels(),d=a.getBreakpoint(e.breakpoints,d),c;c=a.isEmpty(d)?c=e.defaultBreakpoint.folder:d.folder;a.setBreakpoint(b,c)},setImages:function(b,e){viewPortWidth=a.getViewportWidthInCssPixels();breakpoint=a.getBreakpoint(h.settings[e].breakpoints,viewPortWidth);breakpointVal=a.isEmpty(breakpoint)?h.settings[e].defaultBreakpoint.folder:breakpoint.maxWidth||breakpoint.minWidth;a.currentBreakpoint!=breakpointVal&&(e==a.selector[Object.size(a.selector)-1]&&(a.currentBreakpoint=breakpointVal),
a.forEach(b,function(d,c){a.setImage(b[c],h.settings[e])}),a.addEvent("scroll",window,a.setLazySrc))},setLazySrc:function(){for(var b=a.lazyElems.length;b--;)a.inviewport(a.lazyElems[b])&&(a.lazyElems[b].src=a.lazyElems[b].getAttribute("data-lag-src"),a.lazyElems[b].removeAttribute("height"),a.lazyElems.splice(b,1));a.lazyElems.length||a.removeEvent("scroll",window,a.setLazySrc)},setSrc:function(b,e){/(^|\s)lag(\s|$)/.test(b.className)?(b.setAttribute("data-lag-src",e),a.lazyElems.push(b)):"img"===
b.nodeName.toLowerCase()?(b.src=e,b.removeAttribute("height")):(b.style.backgroundImage="url("+e+")",b.style.backgroundRepeat="no-repeat")},supportsOrientationChange:function(){return"ontouchstart"in window}},h={settings:[],init:function(b,e){a.currentBreakpoint=0;if(document.all&&!document.addEventListener){var d=Array.prototype.slice;Array.prototype.slice=function(){if(this instanceof Array)return d.apply(this,arguments);for(var a=[],b=2<=arguments.length?arguments[1]:this.length,c=1<=arguments.length?
arguments[0]:0;c<b;c++)a.push(this[c]);return a}}var c=Array.prototype.slice.call(document.querySelectorAll(b)),f={breakpoints:[{folder:"480",maxWidth:480},{folder:"640",minWidth:481,maxWidth:767},{folder:"900",minWidth:768,maxWidth:900},{folder:"1170",minWidth:992},{folder:"900",minWidth:748,maxWidth:1024},{folder:"640",maxWidth:320,minDevicePixelRatio:2},{folder:"900",minWidth:320,maxWidth:667,minDevicePixelRatio:2},{folder:"2048",minWidth:414,maxWidth:736,minDevicePixelRatio:3},{folder:"2048",
minWidth:748,maxWidth:1024,minDevicePixelRatio:2}],parentOffset:!0},f="object"===typeof e&&"breakpoints"in e?"extend"in e&&!0===e.extend?a.extend(f,e):e:a.extend(f,e),g,k=function(){g--;if(!g)h.settings[b].onComplete()};f.defaultBreakpoint="defaultBreakpoint"in e?e.defaultBreakpoint:{folder:"1170"};h.settings[b]=f;a.selector[Object.size(a.selector)]=b;a.mergedElements[b]=c;a.setImages(c,b);a.setLazySrc();a.addEvent("scroll",window,a.setLazySrc);a.addEvent(a.orientationEvent(),window,a.debounce(function(){a.forEach(a.selector,
function(b,c){a.setImages(a.mergedElements[a.selector[c]],a.selector[c])})},250));"onComplete"in h.settings[b]&&(g=c.length)&&a.forEach(c,function(e,d){if(/[ws]*(lag)+[ws]*/.test(c[d].className)){if(g--,!g)h.settings[b].onComplete()}else if(c[d].onload=k,"complete"==c[d].readyState)c[d].onload();else if(c[d].readyState)c[d].src=c[d].src;else if(c[d].complete)c[d].onload();else if(void 0===c[d].complete){var f=c[d].src;c[d].src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
c[d].src=f}a.setImage(c[d],h.settings[b])})},reset:function(b){a.currentBreakpoint=0;var e=a.mergedElements[b];a.forEach(a.mergedElements[b],function(d,c){a.removeClass(a.mergedElements[b][c],b.substring(1))});h.init(b,h.settings[b]);a.forEach(e,function(a,c){e[c].className+=b.substring(1)})}};return h});