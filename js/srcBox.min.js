;(function(m,a){"function"===typeof define&&define.amd?define(a):"object"===typeof exports?module.exports=a:m.srcBox=a(m)})(this,function(m){var a={newItems:[],devicePixelRatio:function(){return"devicePixelRatio"in window?window.devicePixelRatio:1},lazyElems:[],breakpoint:0,currentBreakpoint:0,breakpointVal:0,viewPortWidth:0,forEach:function(b,a,c){if("[object Object]"===Object.prototype.toString.call(b))for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&a.call(c,b[e],e,b);else{e=0;for(var f=
b.length;e<f;e++)a.call(c,b[e],e,b)}},extend:function(b,d){var c={};a.forEach(b,function(a,d){c[d]=b[d]});a.forEach(d,function(b,a){c[a]=d[a]});return c},getViewportWidthInCssPixels:function(){for(var b=Math,a=[window.innerWidth,window.document.documentElement.clientWidth,window.document.documentElement.offsetWidth,window.document.body.clientWidth],c=0,e,f=window.screen.width;c<a.length;c++)isNaN(a[c])&&(a.splice(c,1),c--);a.length&&(e=b.max.apply(b,a),isNaN(f)||(e=b.min(f,e)));return e||f||0},getBreakpoint:function(b,
d){for(var c=d,e=0,f={},g,h,l,k;g=b[e];){k=g.minWidth;h=g.maxWidth;l="minDevicePixelRatio"in g?g.minDevicePixelRatio:0;if(0<d){if(k&&h&&d>=k&&d<=h||k&&!h&&d>=k||h&&!k&&d<=h)if(!l||l&&a.devicePixelRatio()>=l)f=g}else if(0>=c||k<c||h<c)c=k||h||c,f=g;e++}return f},setBreakpoint:function(b,d){var c=b.getAttribute("data-breakpoint"),e=b.getAttribute("data-img");if(!c||!e)throw Error('srcBox.js [function setBreakpoint]: The provided elements are missing a data-breakpoint or data-img attribute: <img data-breakpoint="/path/to/folder/{breakpoint}" data-img="some-img.jpg" />');
c=c.replace("{folder}",d)+b.getAttribute("data-img");/(^|\s)lag(\s|$)/.test(b.className)?(b.setAttribute("data-lag-src",c),a.lazyElems.push(b)):(b.src=c,b.removeAttribute("height"))},addEvent:function(a,d,c){d.addEventListener?d.addEventListener(a,c,!1):d.attachEvent?d.attachEvent("on"+a,c):d[a]=c},removeEvent:function(a,d,c){d.removeEventListener?d.removeEventListener(a,c,!1):d.detachEvent?d.detachEvent("on"+a,c):d.splice(a,1)},scrollPos:function(){return[void 0!==window.pageYOffset?window.pageYOffset:
(document.documentElement||document.body.parentNode||document.body).scrollTop,void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft]},offset:function(a,d){a=a.getBoundingClientRect();switch(d){case "left":return a.left;case "top":return a.top;default:return 0}},belowthefold:function(b){return(window.innerHeight?window.innerHeight:Math.max(document.documentElement.clientHeight,document.body.clientHeight))+a.scrollPos()[0]<=a.offset(b,
"top")},rightoffold:function(b){return(window.innerWidth?window.innerWidth:Math.max(document.documentElement.clientWidth,document.body.clientWidth))+a.scrollPos()[1]<=a.offset(b,"left")},abovethetop:function(b){return a.scrollPos()[0]>=a.offset(b,"top")+b.height},leftofbegin:function(b){return a.scrollPos()[1]>=a.offset(b,"left")+b.width},inviewport:function(b){return!a.rightoffold(b)&&!a.leftofbegin(b)&&!a.belowthefold(b)&&!a.abovethetop(b)},setLazySrc:function(){for(var b=a.lazyElems.length;b--;)a.inviewport(a.lazyElems[b])&&
(a.lazyElems[b].src=a.lazyElems[b].getAttribute("data-lag-src"),a.lazyElems[b].removeAttribute("height"),a.lazyElems.splice(b,1));a.lazyElems.length||a.removeEvent("scroll",window,a.setLazySrc)},debounce:function(a,d,c){var e;return function(){var f=this,g=arguments,h=c&&!e;clearTimeout(e);e=setTimeout(function(){e=null;c||a.apply(f,g)},d);h&&a.apply(f,g)}},setImage:function(b,d){if("IMG"===b.nodeName){var c=a.getBreakpoint(d.breakpoints,b.parentNode.offsetWidth);a.setBreakpoint(b,"minDevicePixelRatio"in
c?c.maxWidth:c.folder-0)}},setImages:function(b,d){viewPortWidth=a.getViewportWidthInCssPixels();breakpoint=a.getBreakpoint(d.breakpoints,viewPortWidth);breakpointVal="minDevicePixelRatio"in breakpoint?breakpoint.maxWidth:breakpoint.folder-0;a.currentBreakpoint!==breakpointVal&&(a.currentBreakpoint=breakpointVal,a.forEach(b,function(c,e){a.setImage(b[e],d)}),a.addEvent("scroll",window,a.setLazySrc))},waitForNew:function(b){b.cancelBubble=!0;b.stopPropagation&&b.stopPropagation();var d;"IMG"===b.target.nodeName?
(d=b.target,a.newItems.push(d)):b.target.querySelector&&(d=b.target.querySelectorAll("img"),a.forEach(d,function(b,e){a.newItems.push(d[e])}))},supportsOrientationChange:function(){return"ontouchstart"in window},orientationEvent:function(){return supportsOrientationChange?"orientationchange":"resize"}};return function(b,d){var c=document.querySelectorAll(b),e={breakpoints:[{folder:"480",maxWidth:480},{folder:"640",minWidth:481,maxWidth:767},{folder:"900",minWidth:768,maxWidth:900},{folder:"1170",
minWidth:992},{folder:"900",minWidth:748,maxWidth:1024},{folder:"640",maxWidth:320,minDevicePixelRatio:2},{folder:"900",minWidth:320,maxWidth:667,minDevicePixelRatio:2},{folder:"2048",minWidth:414,maxWidth:736,minDevicePixelRatio:3},{folder:"2048",minWidth:748,maxWidth:1024,minDevicePixelRatio:2}]},f="object"===typeof d?a.extend(e,d):e,g,h=function n(){g--;if(!g)f.onNewNode();a.removeEvent("load",c,n)},l=function p(){g--;if(!g)f.onComplete();a.removeEvent("load",c,p)};a.setImages(c,f);a.setLazySrc();
a.addEvent("scroll",window,a.setLazySrc);a.addEvent(a.orientationEvent,window,a.debounce(function(){a.setImages(c,f)},250));"onNewNode"in f&&a.addEvent("load",window,function(){a.addEvent("DOMNodeInserted",document,a.debounce(function(){if(g=a.newItems.length)a.forEach(a.newItems,function(b,c){/[ws]*(srcbox)+[ws]*/.test(a.newItems[c].className)&&(a.setImage(a.newItems[c],f),a.addEvent("load",a.newItems[c],h))}),a.newItems.splice(0,a.newItems.length)},250));a.addEvent("DOMNodeInserted",document,a.waitForNew)});
"onComplete"in f&&(g=c.length)&&a.forEach(c,function(b,d){if(/[ws]*(srcbox)+[ws]*/.test(c[d].className))if(a.setImage(c[d],f),/[ws]*(lag)+[ws]*/.test(c[d].className)){if(g--,!g)f.onComplete()}else a.addEvent("load",c[d],l)})}});